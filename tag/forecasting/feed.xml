<?xml version="1.0" encoding="UTF-8"?>

<rss version="2.0"
  xmlns:content="http://purl.org/rss/1.0/modules/content/"
  xmlns:dc="http://purl.org/dc/elements/1.1/"
  xmlns:media="http://search.yahoo.com/mrss/"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:georss="http://www.georss.org/georss">

  <channel>
    <title>
      <![CDATA[  {{fd2rss website_title}}  ]]>
    </title>
    <link> {{website_url}} </link>
    <description>
      <![CDATA[  {{fd2rss website_description}}  ]]>
    </description>
    <atom:link
      href="{{fd_rss_feed_url}}"
      rel="self"
      type="application/rss+xml" />


<item>
  <title>
    <![CDATA[  ARCH models  ]]>
  </title>
  <link> https://oizin.github.io/posts/bitcoin-volatility/index.html </link>
  <guid> https://oizin.github.io/posts/bitcoin-volatility/index.html </guid>
  <description>
    <![CDATA[  An quick overview of volatility modelling with ARCH models  ]]>
  </description>  
  
  <content:encoded>
    <![CDATA[  <h1 id="bitcoin_price_volatility_with_arch_models">Bitcoin price volatility with ARCH models</h1>
<p>Oisín Fitzgerald, March 2021</p>
<div class="boxed">I wrote this post to remind myself of the basic strategies behind how &#40;financial&#41; time series are analysed and how volatility models work. In particular I examine the ARCH model. Don&#39;t take the attempt to forecast the distributions of Bitcoin / US dollar price movements seriously - I would bet precisely &#36;0 on this model. I hope to do a more detailed post on how to evaluate forecasts in the future.</div>
<h2 id="introduction">Introduction </h2>
<p>It&#39;s January 2021 and Bitcoin price have been breaking all time highs. In this context I wanted to explore statistical methods for estimating and forecasting volatility, in particular autoregressive conditional heteroscedasticity &#40;ARCH&#41; models. Volatility is variation around the mean return of a financial asset. Low volatility implies prices are bunched near the mean while high volatility implies large swings in prices. It is considered a measure of investment risk. For example, we may be convinced Bitcoin will continue to rise in value over the short term but reluctant to engage in speculation if there is significant volatility reducing our chances of being able to buy in and sell at &quot;good&quot; prices &#40;even if there a upward trend&#41;. I&#39;ll add I&#39;m not an expert on financial markets, and that models and graphs below are coded in R.</p>
<pre><code class="language-r"># packages
library&#40;data.table&#41;
library&#40;ggplot2&#41;</code></pre>
<pre><code class="language-r"># read in data
# Source: https://www.kaggle.com/mczielinski/bitcoin-historical-data
dt_daily_close &lt;- fread&#40;&quot;./bitcoin-daily-close-2012-2020.csv&quot;&#41;</code></pre>
<h2 id="bitcoin_bull_markets">Bitcoin bull markets</h2>
<p>To say the Bitcoin &#40;BTC&#41; price has been going up recently was probably an understatement, the price has gone up more 100&#37; since the beginning of 2020&#33; Although if we compare with previous bull market in late 2017 where the price went up more than 1000&#37; it is not a unique occurrence in Bitcoin&#39;s history. Indeed, looking at the graph of Bitcoin on a log scale below we see that the recent &#40;relative&#41; growth rate is comparatively low in Bitcoin&#39;s history.</p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-3-1.png" style="padding:0; width:100%" alt=" Figure 1. Bitcoin daily closing prices (2012 to 2020)"/>
<figcaption> Figure 1. Bitcoin daily closing prices (2012 to 2020)</figcaption>
</figure><h2 id="financial_time_series_basics">Financial time series basics</h2>
<p>It is common in the statistical analysis of financial time series to transform the asset price in order to achieve something closer to a series of independent increments &#40;<a href="https://en.wikipedia.org/wiki/Random_walk">a random walk</a>&#41;. If \(B_t\) is the Bitcoin price on day \(t\), the daily &quot;log return&quot; is \(Z_t = log(B_t) - log(B_{t-1})\). Using the log differences might seem rather arbitrary at first but it can justified as 1&#41; making a multiplicative process additive and 2&#41; interpretable as the percentage change in asset value. If \(r_t\) is the return at time \(t \in {1,2,...,T}\) for a starting asset value of \(W_0\) then \(W_T = W_0\prod_{t=1}^T(1+r_t)\). Taking logarithms gives</p>
\[\begin{aligned}
log(W_T) &= log(W_0) + \sum_{t=1}^T log(1+r_t) \\
 &= \underbrace{log(W_0) + \sum_{t=1}^{T-1} log(1+r_t)}_{log(W_{T-1})} + log(1+r_T) \\
log(1+r_T) &= log(W_T) - log(W_{T-1})\\
\end{aligned}\]
<p>Further for small \(r_t\) the percentage price is approximately equal to the log return, i.e. \(log \approx x\). So the <a href="https://en.wikipedia.org/wiki/Random_walk_hypothesis">random-walk hypothesis</a> hopes that the relative price changes are close to an independent process.</p>
<pre><code class="language-r">dt_daily_ret &lt;- dt_daily_close&#91;,.&#40;return &#61; diff&#40;log&#40;Close&#41;&#41;&#41;&#93;
dt_daily_ret&#91;,date :&#61; dt_daily_close&#36;date&#91;-1&#93;&#93;</code></pre>
<p>We can see in the plot below that \(Z_t\) appears to be a zero mean process. However, comparing it to a simulated white noise process we see much greater variation in the magnitude of deviations from the the mean. The Bitcoin returns also exhibit clustering in their variance over time. These are characteristics the ARCH model was designed to account for.</p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-5-1.png" style="padding:0; width:100%" alt=" Figure 2. Bitcoin daily returns compared to white noise"/>
<figcaption> Figure 2. Bitcoin daily returns compared to white noise</figcaption>
</figure><p>An alternative way to look at a times series is plots of the autocorrelation function &#40;ACF&#41; and partial autocorrelation function &#40;PACF&#41;. The ACF graphs the correlation between observations at time \(Z_t\) and \(Z_{t-h}\) for various values of \(h\). Since we average over \(t\) we are assuming that the series is <a href="https://en.wikipedia.org/wiki/Stationary_process">stationary</a> - intuitively that it&#39;s statistical properties don&#39;t depend on \(t\).  The PACF graphs the correlation between \(Z_t\) and \(Z_{t-h}\) with all intermediate values \(Z_{t-1},Z_{t-2},...,Z_{t-h+1}\) regressed out. Below are ACF and PACF graphs of the series \({Z_t}\) and \({Z_t^2}\). While \(Z_t\) appears to have relatively weak patterns the ACF and PACF of the \(Z_t^2\) process demonstrates clear dependence in the process variance. </p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-6-1.png" style="padding:0; width:100%" alt=" Figure 3. Autocorrelation function of Bitcoin daily returns and squared returns"/>
<figcaption> Figure 3. Autocorrelation function of Bitcoin daily returns and squared returns</figcaption>
</figure><p>A formal test of independence of a time-series, the Ljung–Box test, strongly rejects independence in \(Z_t^2\) with a small p-value. We also reject independence of the \(Z_t\) increments but this is much weaker signal.</p>
<pre><code class="language-r"># test of Z_t
Box.test&#40;dt_daily_ret&#36;return,type &#61; &quot;Ljung-Box&quot;&#41;</code></pre>
<pre><code class="language-julia">## 
## 	Box-Ljung test
## 
## data:  dt_daily_ret&#36;return
## X-squared &#61; 5.9396, df &#61; 1, p-value &#61; 0.0148</code></pre>
<pre><code class="language-r"># test of Z_t^2
Box.test&#40;dt_daily_ret&#36;return^2,type &#61; &quot;Ljung-Box&quot;&#41;</code></pre>
<pre><code class="language-julia">## 
## 	Box-Ljung test
## 
## data:  dt_daily_ret&#36;return^2
## X-squared &#61; 399.32, df &#61; 1, p-value &lt; 2.2e-16</code></pre>
<h2 id="autoregressive_conditional_heteroscedasticity_models">Autoregressive conditional heteroscedasticity models</h2>
<p>Autoregressive conditional heteroscedasticity &#40;ARCH&#41; models, developed by Robert Engle in 1982, were designed to account for processes in which the variance of the return fluctuates. ARCH processes exhibit the time varying variance and volatility clustering seen in the graph of Bitcoin returns above. An ARCH&#40;p&#41; series is generated as \(X_t = \sqrt h_t e_t\), with \(h_t = \alpha_0 + \sum \alpha_i X_{t-i}^2\) and \(e_t \sim N(0,1)\). There have been extensions to the model since 1982 with generalised ARCH &#40;GARCH&#41; and it&#39;s various flavours &#40;IGARCH, EGARCH, ...&#41; which allow more complex patterns such as somewhat &quot;stickier&quot; volatility clustering.</p>
<p>I always like to try and understand how a model works by either simulating form it &#40;for statistical models&#41; or using simulated data to understand it&#39;s performance &#40;for machine learning models&#41;. Lets simulate some examples of an ARCH&#40;1&#41; process to get an idea of how the simplest version of the process works.</p>
<pre><code class="language-r">simulate_arch1 &lt;- function&#40;a0,a1,n&#61;1000L&#41; &#123;
  # function to simulate an ARCH&#40;1&#41; series
  # a0: ARCH constant
  # a1: ARCH AR term
  # n: length of time series
  xt &lt;- numeric&#40;length &#61; n&#43;1&#41;
  ee &lt;- rnorm&#40;n&#43;1&#41;  
  xt&#91;1&#93; &lt;- ee&#91;1&#93;
  for &#40;i in 2:&#40;n&#43;1&#41;&#41; &#123;
    ht &lt;- a0 &#43; a1*xt&#91;i-1&#93;^2
    xt&#91;i&#93; &lt;- ee&#91;i&#93;*sqrt&#40;ht&#41;
  &#125;
  xt&#91;2:&#40;n&#43;1&#41;&#93;
&#125;</code></pre><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-10-1.png" style="padding:0; width:100%" alt=" Figure 4. Simulated ARCH(1) processes"/>
<figcaption> Figure 4. Simulated ARCH(1) processes</figcaption>
</figure>
<figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-11-1.png" style="padding:0; width:100%" alt=" Figure 5. ACF and PACF for simulated ARCH(1) processes"/>
<figcaption> Figure 5. ACF and PACF for simulated ARCH(1) processes</figcaption>
</figure><p>It is worth remembering that ARCH models are for the volatility, we can also have usual trends, or additional ARIMA components. For example, let&#39;s simulate an AR&#40;1&#41; model with ARCH&#40;1&#41; volatility, \(X_t = u_0 X_{t-1} + \sqrt h_t e_t\). The plots of the ACF and PACF for this series shows similar correlation patterns for both \({X_t}\) and \({X_t^2}\).</p>
<pre><code class="language-r">simulate_ar1_arch1 &lt;- function&#40;u0,a0,a1,n&#61;1000L&#41; &#123;
  # function to simulate AR&#40;1&#41; &#43; ARCH&#40;1&#41; series
  # u0: autoregressive term
  # a0: ARCH constant
  # a1: ARCH AR term
  # n: length of time series
  xt &lt;- numeric&#40;length &#61; n&#43;1&#41;
  ee &lt;- rnorm&#40;n&#43;1&#41;  
  xt&#91;1&#93; &lt;- ee&#91;1&#93;
  for &#40;i in 2:&#40;n&#43;1&#41;&#41; &#123;
    ht &lt;- a0 &#43; a1*xt&#91;i-1&#93;^2
    xt&#91;i&#93; &lt;- u0*xt&#91;i-1&#93; &#43; ee&#91;i&#93;*sqrt&#40;ht&#41;
  &#125;
  xt&#91;2:&#40;n&#43;1&#41;&#93;
&#125;</code></pre><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-13-1.png" style="padding:0; width:100%" alt=" Figure 6. Simulated AR(1) + ARCH(1) processes"/>
<figcaption> Figure 6. Simulated AR(1) + ARCH(1) processes</figcaption>
</figure>
<figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-14-1.png" style="padding:0; width:100%" alt=" Figure 7. ACF and PACF for simulated AR(1) + ARCH(1) processes"/>
<figcaption> Figure 7. ACF and PACF for simulated AR(1) + ARCH(1) processes</figcaption>
</figure><h2 id="modelling_bitcoin_volatility">Modelling Bitcoin volatility</h2>
<p>Now that we&#39;ve got an idea of how ARCH models work let&#39;s move onto modeling Bitcoin returns. We&#39;ll use the R package <code>fGarch</code> which estimates the model parameters using Quasi-Maximum Likelihood Estimation. I picked an ARCH&#40;2&#41; model based on a quick comparison of model fit statistics for different values of the heteroscedasdicity order. The <code>garchFit</code> function prints a lot to the console which you can suppress with <code>trace &#61; FALSE</code>.</p>
<pre><code class="language-r"># fit an ARCH&#40;2&#41; model to Bitcoin returns
library&#40;fGarch&#41;
m1 &lt;- garchFit&#40;~arma&#40;0,0&#41;&#43;garch&#40;2,0&#41;,dt_daily_ret&#36;return,trace&#61;FALSE&#41;
summary&#40;m1&#41;</code></pre>
<pre><code class="language-julia">## 
## Title:
##  GARCH Modelling 
## 
## Call:
##  garchFit&#40;formula &#61; ~arma&#40;0, 0&#41; &#43; garch&#40;2, 0&#41;, data &#61; dt_daily_ret&#36;return, 
##     trace &#61; FALSE&#41; 
## 
## Mean and Variance Equation:
##  data ~ arma&#40;0, 0&#41; &#43; garch&#40;2, 0&#41;
## &lt;environment: 0x000001fe0a5c4c30&gt;
##  &#91;data &#61; dt_daily_ret&#36;return&#93;
## 
## Conditional Distribution:
##  norm 
## 
## Coefficient&#40;s&#41;:
##        mu      omega     alpha1     alpha2  
## 0.0026455  0.0010569  0.2509526  0.2539785  
## 
## Std. Errors:
##  based on Hessian 
## 
## Error Analysis:
##         Estimate  Std. Error  t value Pr&#40;&gt;|t|&#41;    
## mu     2.645e-03   6.524e-04    4.055 5.02e-05 ***
## omega  1.057e-03   3.843e-05   27.502  &lt; 2e-16 ***
## alpha1 2.510e-01   2.827e-02    8.878  &lt; 2e-16 ***
## alpha2 2.540e-01   3.296e-02    7.705 1.31e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Log Likelihood:
##  5898.152    normalized:  1.796027 
## 
## Description:
##  Thu Jan 21 10:57:27 2021 by user: z5110862 
## 
## 
## Standardised Residuals Tests:
##                                 Statistic p-Value     
##  Jarque-Bera Test   R    Chi^2  58727.98  0           
##  Shapiro-Wilk Test  R    W      0.8800886 0           
##  Ljung-Box Test     R    Q&#40;10&#41;  26.3782   0.003263477 
##  Ljung-Box Test     R    Q&#40;15&#41;  39.05692  0.000628423 
##  Ljung-Box Test     R    Q&#40;20&#41;  49.41108  0.0002687736
##  Ljung-Box Test     R^2  Q&#40;10&#41;  14.15045  0.1662389   
##  Ljung-Box Test     R^2  Q&#40;15&#41;  18.71158  0.2271022   
##  Ljung-Box Test     R^2  Q&#40;20&#41;  20.63017  0.4191803   
##  LM Arch Test       R    TR^2   15.36755  0.2219489   
## 
## Information Criterion Statistics:
##       AIC       BIC       SIC      HQIC 
## -3.589618 -3.582192 -3.589621 -3.586959</code></pre>
<p>Calling <code>summary</code> on the resulting model object returns estimates of the model parameters and Ljung–Box statistics for the residuals and squared residuals. The model returned is \(Z_t = 0.00265 + \sqrt h_t e_t\) with \(h_t = 0.001 + 0.251 Z_{t-1}^2 + 0.254 Z_{t-2}^2\). Notice that the Ljung-Box test is significant for the residuals but not squared residuals. The p in <code>Q&#40;p&#41;</code> of the Ljung-Box test results indicates the extent of the autocorrelation lag used in testing for independence of the residuals. So there is evidence of unaccounted for correlation in the data when considering lags up to 15 and 20. However, the ACF and partial ACF  suggest that the remaining auto correlation is somewhat complex and weak enough to ignore for the purposes of illustrating basic volatility forecasting with ARCH model. </p>
<h2 id="rolling_probabilitic_forecast">Rolling probabilitic forecast</h2>
<p>One use of such a model may be to forecast the one day ahead distribution of returns. Our forecasts are of the form \(Z_{t+1} \sim N(0,\hat{\alpha}_0 + \hat{\alpha}_1 Z_{t-1}^2 + \hat{\alpha}_2 Z_{t-2}^2)\). These forecasted distributions can be used to assess the probability of price movements of a particular size. Since we might believe the parameters of the model are not constant I&#39;ll use a rolling forecast window of 300&#43;1 days. So starting at day 301 &#40;2012-10-26&#41; until the final day 3,285 &#40;2020-12-31&#41; I&#39;ll fit an ARCH&#40;2&#41; model to the previous 300 days and forecast forward one day. We can see in the results that there is considerable room for improvement, the model fails to capture many of the large price movements, but that it is not producing complete nonsense either. </p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-17-1.png" style="padding:0; width:100%" alt=" Figure 8. The red points are outside the 95% forecast intervals"/>
<figcaption> Figure 8. The red points are outside the 95% forecast intervals</figcaption>
</figure><h2 id="assessing_the_forecasts">Assessing the forecasts</h2>
<p>A more thorough evaluation of the forecasts involves assessing their calibration and dispersion &#40;I won&#39;t go into details on this aspect, see for example Gneiting and Katzfuss &#40;2014&#41;&#41;. From the graphs below we see that our forecasts are poorly calibrated - the forecasted probabilities of price movement are not reliable. They are likely to over estimate the probability of a large price movement &#40;overdispersion&#41;. </p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-18-1.png" style="padding:0; width:100%" alt=" Figure 9. Assessment of calibration"/>
<figcaption> Figure 9. Assessment of calibration</figcaption>
</figure><p>We might wonder whether the poor performance came about due to the large drop in March 2020 influencing future predictions. However, this doesn&#39;t appear to be the case. The prediction strategy I used is simply not good&#33; </p><figure style="text-align:center;">
<img src="https://oizin.github.io/assets/bitcoin-volatility-20210118/unnamed-chunk-19-1.png" style="padding:0; width:100%" alt=" Figure 10. Assessment of calibration (pre March 2020)"/>
<figcaption> Figure 10. Assessment of calibration (pre March 2020)</figcaption>
</figure><h2 id="thats_all">That&#39;s all&#33;</h2>
<p>Thanks for reading. This was a relatively simplistic introduction to the use of ARCH models for forecasting volatility in the Bitcoin market. ARCH models allow the variance of time series at time \(t\) to depend on the variance of previous terms \({t-1,t-2,...}\), analogous to how autoregressive models. This allows us to forecast distributions of future prices in a manner that is more reflective of empirical observations of financial time series.   </p>
<h2 id="reading_and_links">Reading and links</h2>
<ul>
<li><p>Gneiting, T., &amp; Katzfuss, M. &#40;2014&#41;. Probabilistic forecasting. Annual Review of Statistics and Its Application, 1, 125-151.  </p>
</li>
<li><p>Engle, R. F. &#40;1982&#41;. Autoregressive conditional heteroscedasticity with estimates of the variance of United Kingdom inflation. Econometrica: Journal of the Econometric Society, 987-1007.  </p>
</li>
<li><p>Bollerslev, T. &#40;1986&#41;. Generalized autoregressive conditional heteroskedasticity. Journal of econometrics, 31&#40;3&#41;, 307-327.  </p>
</li>
<li><p>Data source: https://www.kaggle.com/mczielinski/bitcoin-historical-data   </p>
</li>
<li><p>fGarch R package: https://cran.r-project.org/web/packages/fGarch/fGarch.pdf  </p>
</li>
</ul>
    <script src="https://utteranc.es/client.js"
        repo="oizin/oizin.github.io"
        issue-term="title"
        label="Comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
    </script> ]]>
  </content:encoded>
    
  <pubDate>Mon, 01 Mar 2021 00:00:00 +0000</pubDate>  
  
  
  <atom:author>
    <atom:name>Oisin Fitzgerald</atom:name>
  </atom:author>
        
</item>
</channel></rss>